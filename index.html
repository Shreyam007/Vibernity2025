<!DOCTYPE html>
<html class="dark" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Recruitment Assistant</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800;900&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
    <style>
        .glassmorphism {
            background: rgba(34, 47, 73, 0.4); /* bg-[#222f49]/40 */
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(49, 67, 104, 0.5); /* border-[#314368]/50 */
            transition: all 300ms ease-in-out; /* Added for smooth D&D transition */
        }
        /* New D&D class */
        .is-drag-over {
            border-color: #0d59f2 !important; /* Primary color */
            background: rgba(13, 89, 242, 0.1) !important; /* Primary/10 */
        }
        /* Style for disabled button */
        #home-compare-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        /* Custom scrollbar for better dark mode aesthetics */
        body::-webkit-scrollbar {
            width: 8px;
        }
        body::-webkit-scrollbar-thumb {
            background-color: #314368;
            border-radius: 4px;
        }
        body::-webkit-scrollbar-track {
            background-color: #1A2233;
        }
        /* Custom input and select styles for profile page */
        .profile-input {
            /* Tailwind @apply to style the input fields consistently */
            @apply w-full px-4 py-3 rounded-lg bg-[#222f49] border border-[#314368] text-white placeholder-white/50 focus:border-primary focus:ring-primary focus:outline-none transition-colors;
        }
        /* Active nav item for Profile sidebar */
        .profile-nav-active {
            @apply bg-primary/20 text-primary font-bold;
        }
    </style>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#0d59f2",
                        "background-light": "#f5f6f8",
                        "background-dark": "#101622",
                    },
                    fontFamily: {
                        "display": ["Manrope", "Inter", "sans-serif"] 
                    },
                    borderRadius: {
                        "DEFAULT": "0.5rem",
                        "lg": "1rem", 
                        "xl": "1.5rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
</head>
<body class="bg-background-dark font-display text-white">
<div class="relative flex h-auto min-h-screen w-full flex-col overflow-x-hidden">
    <div class="absolute top-0 left-0 w-full h-full z-0 overflow-hidden">
        <div class="absolute -top-1/4 -left-1/4 w-1/2 h-1/2 bg-primary/20 rounded-full blur-3xl animate-pulse"></div>
        <div class="absolute bottom-0 right-0 w-1/2 h-1/2 bg-primary/20 rounded-full blur-3xl animate-pulse delay-1000"></div>
    </div>

    <div class="layout-container flex h-full grow flex-col z-10">
        <div id="app-header-container" class="sticky top-0 z-50 bg-background-dark/90 backdrop-blur-md">
            <header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-[#222f49] px-4 sm:px-10 py-3">
                <div class="flex items-center gap-4 text-white">
                    <div class="size-6 text-primary">
                        <svg fill="none" viewbox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
                            <path d="M24 45.8096C19.6865 45.8096 15.4698 44.5305 11.8832 42.134C8.29667 39.7376 5.50128 36.3314 3.85056 32.3462C2.19985 28.361 1.76794 23.9758 2.60947 19.7452C3.451 15.5145 5.52816 11.6284 8.57829 8.5783C11.6284 5.52817 15.5145 3.45101 19.7452 2.60948C23.9758 1.76795 28.361 2.19986 32.3462 3.85057C36.3314 5.50129 39.7376 8.29668 42.134 11.8833C44.5305 15.4698 45.8096 19.6865 45.8096 24L24 24L24 45.8096Z" fill="currentColor"></path>
                        </svg>
                    </div>
                    <h2 class="text-white text-lg font-bold leading-tight tracking-[-0.015em]">Recruitment Assistant</h2>
                </div>
                <div class="hidden md:flex flex-1 justify-end gap-8">
                    <div class="flex items-center gap-9">
                        <a class="nav-link text-white/80 hover:text-white transition-colors text-sm font-medium leading-normal" href="#dashboard" data-page="dashboard">Dashboard</a>
                        <a class="nav-link text-white/80 hover:text-white transition-colors text-sm font-medium leading-normal" href="jobs.html" data-page="jobs">Jobs</a>
                        <a class="nav-link text-white/80 hover:text-white transition-colors text-sm font-medium leading-normal" href="#candidates" data-page="candidates">Candidates</a>
                        <a class="nav-link text-white/80 hover:text-white transition-colors text-sm font-medium leading-normal" href="#compare" data-page="compare" id="compare-link">Compare</a>
                    </div>
                    <div class="flex items-center gap-2" id="header-buttons-container">
                    </div>
                </div>
                <button class="md:hidden flex items-center justify-center rounded-lg h-10 w-10 bg-[#222f49] text-white">
                    <span class="material-symbols-outlined">menu</span>
                </button>
            </header>
        </div>

        <div class="px-4 sm:px-10 md:px-20 lg:px-40 flex flex-1 justify-center py-5">
            <div class="layout-content-container flex flex-col w-full max-w-6xl flex-1">
                <main class="flex-1 flex flex-col items-center py-10 sm:py-16" id="app-main-content">
                    </main>
            </div>
        </div>
    </div>
</div>

<button class="fixed bottom-8 right-8 flex items-center gap-3 px-6 py-3 bg-primary text-white font-bold rounded-full shadow-lg hover:bg-primary/90 transition-colors hidden" id="ask-ai-button">
    <span class="material-symbols-outlined">smart_toy</span>
    Ask AI Why?
</button>

<script>
    // ---------------------------------------------------
    // Global State & Data
    // ---------------------------------------------------
    let jobFileUploaded = false;
    let candidateAFileUploaded = false;
    let candidateBFileUploaded = false;
    
    // --- Simulated User Data for Profile Page ---
    const USER_PROFILE_DATA = {
        name: "John Doe",
        title: "Recruitment Manager",
        company: "Innovatech Solutions",
        email: "j.doe@example.com",
        avatar: "https://lh3.googleusercontent.com/aida-public/AB6AXuDtriDyF7CKP0JkUOmiT0fssp3lIxPOUL9bi5QTe3M8mzKQcFgUOQgZWlUJy-lA810Whm_4_lYeRgN9gFP8UxpGUFdlb-efEViBvDzCISd-lgqDwBGZpu40-2EQhgMlVME5I6SIV02qISbARHT_HsjSwIqcLtyhVMivK8U6xEiv_tcA_S6oAw4ViXqZImU6rwn8AiaE8hONolqmcwo1yBnWZhDAeDU1W7uH_screhqrAsnLG4oBqZIvsLpVQL3gkv90VjeuvQeGYYAa" // Default avatar used in header
    };
    
    // Mock Data (Assuming they are defined elsewhere or simplified for this context)
    const CANDIDATE_A_DATA = { 
        name: "Liam Carter",
        title: "Senior Frontend Developer",
        match: 92,
        experience: "8 years",
        skills: ["React", "Next.js", "TypeScript", "Tailwind CSS", "Jest"],
        missingSkills: ["AWS"],
        avatar: "https://i.pravatar.cc/150?img=68"
    };
    const CANDIDATE_B_DATA = { 
        name: "Olivia Chen",
        title: "Full Stack Engineer",
        match: 78,
        experience: "6 years",
        skills: ["Node.js", "Express", "GraphQL", "MongoDB", "React"],
        missingSkills: ["Next.js", "TypeScript"],
        avatar: "https://i.pravatar.cc/150?img=47"
    };
    const RECENT_DECISIONS = [
        { candidates: "Sarah J. vs Mark K.", time: "2 hours ago" },
        { candidates: "Alex R. vs Ben W.", time: "1 day ago" },
        { candidates: "Emily B. vs David C.", time: "3 days ago" },
        { candidates: "Fiona G. vs George H.", time: "1 week ago" },
    ];
    const CANDIDATES_DATA = []; // Placeholder for full candidates list
    
    // ... (Your other global data here) ...

    // ---------------------------------------------------
    // Core UI Components and Listeners
    // ---------------------------------------------------

    function getSkillTag(skill, isMissing = false) {
        const bgColor = isMissing ? 'bg-orange-500/20' : 'bg-primary/20';
        const textColor = isMissing ? 'text-orange-400' : 'text-primary';
        return `<span class="px-3 py-1 text-sm font-medium ${bgColor} ${textColor} rounded-full">${skill}</span>`;
    }

    function setActiveLink(page) {
        document.querySelectorAll('.nav-link').forEach(link => {
            // Check if the link corresponds to the current page
            if (link.dataset.page === page || (page === 'home' && link.dataset.page === 'dashboard')) {
                link.classList.add('text-primary', 'font-bold');
                link.classList.remove('text-white/80', 'font-medium');
            } else {
                link.classList.remove('text-primary', 'font-bold');
                link.classList.add('text-white/80', 'font-medium');
            }
        });
        
        // Custom styling for profile button (it's not a standard nav-link)
        const profileBtn = document.getElementById('profile-btn');
        if (profileBtn) {
             if (page === 'profile' || page === 'security' || page === 'settings') {
                profileBtn.classList.add('border-primary'); // Highlight border for active profile
                profileBtn.classList.remove('border-primary/50');
             } else {
                profileBtn.classList.remove('border-primary');
                profileBtn.classList.add('border-primary/50');
             }
        }
        
        // Custom styling for profile sidebar links
        document.querySelectorAll('.profile-nav-link').forEach(link => {
            link.classList.remove('profile-nav-active');
            link.classList.add('text-white/80', 'hover:bg-[#222f49]', 'hover:text-white', 'font-medium');
            if (link.dataset.page === page) {
                link.classList.add('profile-nav-active');
                link.classList.remove('text-white/80', 'hover:bg-[#222f49]', 'hover:text-white', 'font-medium');
            }
        });
    }

    function attachHeaderButtonListeners() {
        const notificationsBtn = document.getElementById('notifications-btn');
        const settingsBtn = document.getElementById('settings-btn');
        const profileBtn = document.getElementById('profile-btn');
        const filterBtn = document.getElementById('filter-btn');
        const newSearchBtn = document.getElementById('new-search-btn');

        if (notificationsBtn) notificationsBtn.addEventListener('click', () => alert('Notifications clicked!'));
        if (settingsBtn) settingsBtn.addEventListener('click', () => {
            // Navigate to the settings page within the profile section
            window.location.hash = '#settings'; 
        });
        
        // Update profile button to navigate to the profile page
        if (profileBtn) profileBtn.addEventListener('click', () => {
            window.location.hash = '#profile';
        });
        
        if (filterBtn) filterBtn.addEventListener('click', () => alert('Filter Candidates clicked!'));
        if (newSearchBtn) newSearchBtn.addEventListener('click', () => alert('New Candidate Search clicked!'));
    }

    function renderHeaderButtons(currentPage) {
        let buttonsHtml = `
            <button id="notifications-btn" class="relative flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 bg-[#222f49] text-white/80 hover:text-white hover:bg-primary/30 transition-colors gap-2 text-sm font-bold leading-normal tracking-[0.015em] min-w-0 px-2.5">
                <span class="material-symbols-outlined">notifications</span>
            </button>
            <button id="settings-btn" class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 bg-[#222f49] text-white/80 hover:text-white hover:bg-primary/30 transition-colors gap-2 text-sm font-bold leading-normal tracking-[0.015em] min-w-0 px-2.5">
                <span class="material-symbols-outlined">settings</span>
            </button>
            <div id="profile-btn" class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 border-2 border-primary/50 cursor-pointer transition-all" data-alt="User avatar image" style='background-image: url("${USER_PROFILE_DATA.avatar}");'></div>
        `;

        if (currentPage === 'candidates') {
            const candidateButtons = `
                <button id="filter-btn" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-primary text-white text-sm font-bold leading-normal tracking-[0.015em] hover:bg-primary/90 transition-colors">
                    <span class="truncate">Filter</span>
                </button>
                <button id="new-search-btn" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-[#222f49] text-white text-sm font-bold leading-normal tracking-[0.015em] hover:bg-primary/30 transition-colors">
                    <span class="truncate">New Search</span>
                </button>
            `;
            // Add Candidate buttons before the standard buttons
            buttonsHtml = candidateButtons + buttonsHtml; 
        }

        const container = document.getElementById('header-buttons-container');
        if (container) {
            container.innerHTML = buttonsHtml;
            attachHeaderButtonListeners();
        }
    }


    // ---------------------------------------------------
    // Upload Functionality (Mocked)
    // ---------------------------------------------------
    
    function updateCompareButtonState() { 
        const compareBtn = document.getElementById('home-compare-button');
        if (compareBtn) {
            compareBtn.disabled = !(jobFileUploaded && candidateAFileUploaded && candidateBFileUploaded);
        }
    }
    
    function handleFileSelect(file, nameElementId, buttonTextId, fileType) { 
        const fileNameElement = document.getElementById(nameElementId);
        const buttonTextElement = document.getElementById(buttonTextId);

        if (file) {
            const fileName = file.name;
            fileNameElement.textContent = fileName;
            buttonTextElement.textContent = 'Change File';
            
            // Update global state
            if (fileType === 'job') jobFileUploaded = true;
            if (fileType === 'candidateA') candidateAFileUploaded = true;
            if (fileType === 'candidateB') candidateBFileUploaded = true;
        } else {
            fileNameElement.textContent = fileType === 'job' ? 'Job Description' : (fileType === 'candidateA' ? 'Candidate A Profile' : 'Candidate B Profile');
            buttonTextElement.textContent = 'Upload File';

            // Update global state
            if (fileType === 'job') jobFileUploaded = false;
            if (fileType === 'candidateA') candidateAFileUploaded = false;
            if (fileType === 'candidateB') candidateBFileUploaded = false;
        }
        updateCompareButtonState();
    }
    
    function setupUploadListener(uploadContainerId, inputId, nameId, buttonTextId, fileType) { 
        const input = document.getElementById(inputId);
        const button = document.querySelector(`#${uploadContainerId} button`);
        
        button.addEventListener('click', () => {
            input.click();
        });

        input.addEventListener('change', (e) => {
            handleFileSelect(e.target.files[0], nameId, buttonTextId, fileType);
        });
    }
    
    function setupDragAndDropListener(containerId, inputId, nameId, buttonTextId, fileType) { 
        const container = document.getElementById(containerId);
        const input = document.getElementById(inputId);

        container.addEventListener('dragover', (e) => {
            e.preventDefault();
            container.classList.add('is-drag-over');
        });
        container.addEventListener('dragleave', () => {
            container.classList.remove('is-drag-over');
        });
        container.addEventListener('drop', (e) => {
            e.preventDefault();
            container.classList.remove('is-drag-over');
            const file = e.dataTransfer.files[0];
            if (file) {
                // Simulate setting the file on the input element
                // Note: The actual file upload/read logic is much more complex
                handleFileSelect(file, nameId, buttonTextId, fileType); 
            }
        });
    }


    // ---------------------------------------------------
    // Dynamic Page Rendering Functions
    // ---------------------------------------------------
    
    function renderCandidateCard(candidate) {
        return `
            <div class="lg:col-span-5 p-6 bg-white/5 dark:bg-[#1A2233] rounded-xl border border-white/10 dark:border-[#222f49]">
                <div class="flex items-center gap-4 mb-6 pb-4 border-b border-white/10 dark:border-[#222f49]">
                    <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full h-14 w-14 border-2 border-primary" style='background-image: url("${candidate.avatar}");'></div>
                    <div>
                        <h3 class="text-white text-xl font-bold">${candidate.name}</h3>
                        <p class="text-[#90a4cb]">${candidate.title}</p>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div>
                        <p class="text-[#90a4cb] text-sm">Match Score</p>
                        <p class="text-3xl font-black ${candidate.match > 80 ? 'text-green-400' : 'text-orange-400'}">${candidate.match}%</p>
                    </div>
                    <div>
                        <p class="text-[#90a4cb] text-sm">Relevant Experience</p>
                        <p class="text-xl font-bold text-white">${candidate.experience}</p>
                    </div>
                </div>

                <h4 class="text-white font-bold mb-3">Key Skills</h4>
                <div class="flex flex-wrap gap-2 mb-6">
                    ${candidate.skills.map(s => getSkillTag(s, false)).join('')}
                </div>

                <h4 class="text-white font-bold mb-3">Missing/Weak Skills</h4>
                <div class="flex flex-wrap gap-2">
                    ${candidate.missingSkills.map(s => getSkillTag(s, true)).join('')}
                </div>
            </div>
        `;
    }

    function renderComparePage() {
        let comparisonContent;
        if (jobFileUploaded && candidateAFileUploaded && candidateBFileUploaded) {
            const swapButton = `
                <div class="lg:col-span-2 flex justify-center items-center">
                    <button class="flex items-center justify-center w-14 h-14 rounded-full bg-[#222f49] text-white hover:bg-primary/20 hover:text-primary transition-colors">
                        <span class="material-symbols-outlined text-3xl">swap_horiz</span>
                    </button>
                </div>
            `;

            const summaryAndSuggestions = `
                <div class="lg:col-span-12 mt-8 flex flex-col lg:flex-row gap-8">
                    <div class="flex-1 p-6 bg-white/5 dark:bg-[#1A2233] rounded-xl border border-white/10 dark:border-[#222f49]">
                        <h2 class="text-white text-lg font-bold leading-tight tracking-[-0.015em] mb-4">AI Recommendation</h2>
                        <div class="flex items-start gap-4 p-4 rounded-lg bg-primary/10 border border-primary/30">
                            <span class="material-symbols-outlined text-primary text-2xl mt-1">recommend</span>
                            <p class="text-gray-300"><strong class="font-bold text-white">${CANDIDATE_A_DATA.name} is the stronger fit</strong> due to superior experience in modern frontend frameworks like Next.js and a stronger alignment with core job requirements, yielding a higher efficiency score.</p>
                        </div>
                    </div>
                    <div class="flex-1 p-6 bg-white/5 dark:bg-[#1A2233] rounded-xl border border-white/10 dark:border-[#222f49]">
                        <h2 class="text-white text-lg font-bold leading-tight tracking-[-0.015em] mb-4">Swap Suggestions</h2>
                        <ul class="space-y-3">
                            <li class="flex items-start gap-3">
                                <span class="material-symbols-outlined text-gray-400 mt-1">arrow_right_alt</span>
                                <p class="text-[#90a4cb]">Consider comparing <strong class="text-white">${CANDIDATE_B_DATA.name}</strong> with a candidate for a mid-level backend role due to her GraphQL and Node.js skills.</p>
                            </li>
                            <li class="flex items-start gap-3">
                                <span class="material-symbols-outlined text-gray-400 mt-1">arrow_right_alt</span>
                                <p class="text-[#90a4cb]">Explore candidates with <strong class="text-white">AWS certifications</strong> if cloud expertise is a high-priority requirement for this position.</p>
                            </li>
                        </ul>
                    </div>
                </div>
            `;

            const recentDecisions = `
                <div class="mt-16 w-full">
                    <h2 class="text-white text-2xl font-bold leading-tight tracking-[-0.015em] p-4">Recent AI Decisions</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                        ${RECENT_DECISIONS.map(d => `
                            <div class="flex items-center justify-between p-4 bg-white/5 dark:bg-[#1A2233] rounded-xl border border-white/10 dark:border-[#222f49]">
                                <div class="flex flex-col">
                                    <p class="text-white font-medium">${d.candidates}</p>
                                    <p class="text-[#90a4cb] text-sm">${d.time}</p>
                                </div>
                                <button class="text-gray-400 hover:text-white">
                                    <span class="material-symbols-outlined text-xl">close</span>
                                </button>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;

            comparisonContent = `
                <div class="mt-8 grid grid-cols-1 lg:grid-cols-12 gap-8 items-start w-full px-4 sm:px-10 md:px-20 lg:px-0">
                    ${renderCandidateCard(CANDIDATE_A_DATA)}
                    ${swapButton}
                    ${renderCandidateCard(CANDIDATE_B_DATA)}
                    ${summaryAndSuggestions}
                </div>
                ${recentDecisions}
            `;

        } else {
            comparisonContent = `
                <div class="w-full text-center mt-20">
                    <span class="material-symbols-outlined text-6xl text-primary/50 mb-4">folder_open</span>
                    <p class="text-white text-2xl font-bold">No Data Available for Comparison</p>
                    <p class="text-[#90a4cb] mt-2">Please upload a Job Description and two Candidate Profiles on the home page to view comparison results.</p>
                </div>
            `;
        }

        return `
            <div class="w-full flex flex-wrap justify-between gap-3 p-4">
                <div class="flex min-w-72 flex-col gap-3">
                    <p class="text-white text-4xl font-black leading-tight tracking-[-0.033em]">Candidate Comparison</p>
                    <p class="text-[#90a4cb] text-base font-normal leading-normal">Compare candidates side-by-side with AI-powered insights.</p>
                </div>
            </div>
            ${comparisonContent}
        `;
    }

    function renderCandidatesPage() {
        return `
            <div class="w-full text-center mt-20">
                <p class="text-white text-4xl font-black leading-tight tracking-[-0.033em]">Candidates</p>
                <p class="text-[#90a4cb] text-base font-normal leading-normal mt-2">Manage and review all submitted candidate profiles.</p>
                <div class="mt-8 p-6 bg-[#1A2233] rounded-xl border border-[#222f49]">
                    <p class="text-white/80">Candidates list content will go here.</p>
                </div>
            </div>
        `;
    }

    function renderDashboardPage() {
        return `
            <div class="w-full text-center mt-20">
                <p class="text-white text-4xl font-black leading-tight tracking-[-0.033em]">Compare Candidates</p>
                <p class="text-[#90a4cb] text-base font-normal leading-normal mt-2">Upload a job description and two candidate profiles to see who is the better fit for the role.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mt-12 w-full max-w-4xl">
                <div id="upload-job" class="glassmorphism flex flex-col items-center p-6 border-dashed border-2 border-[#314368] rounded-xl min-h-64 transition-all duration-300">
                    <span class="material-symbols-outlined text-primary text-5xl mt-4">description</span>
                    <h3 class="text-white text-lg font-bold mt-4 line-clamp-1" id="job-file-name">Job Description</h3>
                    <p class="text-[#90a4cb] text-sm mt-1 mb-6">Drag & Drop or Paste Text</p>
                    <input type="file" id="job-file-input" class="hidden" accept=".txt,.pdf,.doc,.docx">
                    <button class="flex items-center gap-2 px-6 py-3 bg-[#222f49] text-white/80 hover:bg-primary/80 transition-colors rounded-lg">
                        <span class="material-symbols-outlined">upload_file</span>
                        <span id="job-button-text">Upload File</span>
                    </button>
                </div>

                <div id="upload-candidate-a" class="glassmorphism flex flex-col items-center p-6 border-dashed border-2 border-[#314368] rounded-xl min-h-64 transition-all duration-300">
                    <span class="material-symbols-outlined text-primary text-5xl mt-4">person</span>
                    <h3 class="text-white text-lg font-bold mt-4 line-clamp-1" id="candidate-a-file-name">Candidate A Profile</h3>
                    <p class="text-[#90a4cb] text-sm mt-1 mb-6">Drag & Drop or Paste Text</p>
                    <input type="file" id="candidate-a-file-input" class="hidden" accept=".txt,.pdf,.doc,.docx">
                    <button class="flex items-center gap-2 px-6 py-3 bg-[#222f49] text-white/80 hover:bg-primary/80 transition-colors rounded-lg">
                        <span class="material-symbols-outlined">upload_file</span>
                        <span id="candidate-a-button-text">Upload File</span>
                    </button>
                </div>

                <div id="upload-candidate-b" class="glassmorphism flex flex-col items-center p-6 border-dashed border-2 border-[#314368] rounded-xl min-h-64 transition-all duration-300">
                    <span class="material-symbols-outlined text-primary text-5xl mt-4">person</span>
                    <h3 class="text-white text-lg font-bold mt-4 line-clamp-1" id="candidate-b-file-name">Candidate B Profile</h3>
                    <p class="text-[#90a4cb] text-sm mt-1 mb-6">Drag & Drop or Paste Text</p>
                    <input type="file" id="candidate-b-file-input" class="hidden" accept=".txt,.pdf,.doc,.docx">
                    <button class="flex items-center gap-2 px-6 py-3 bg-[#222f49] text-white/80 hover:bg-primary/80 transition-colors rounded-lg">
                        <span class="material-symbols-outlined">upload_file</span>
                        <span id="candidate-b-button-text">Upload File</span>
                    </button>
                </div>
            </div>
            
            <button id="home-compare-button" class="mt-12 px-12 py-4 bg-primary text-white font-bold rounded-xl shadow-lg hover:scale-105 transition-transform duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100" disabled>
                Compare Candidates
            </button>
        `;
    }
    
    function renderJobsPage() {
        return `
            <div class="w-full text-center mt-20">
                <p class="text-white text-4xl font-black leading-tight tracking-[-0.033em]">Jobs Page</p>
                <p class="text-[#90a4cb] text-base font-normal leading-normal mt-2">Content for the Jobs page is in a separate file (jobs.html).</p>
                <a href="jobs.html" class="mt-6 inline-block px-6 py-3 bg-primary text-white font-bold rounded-lg hover:bg-primary/90 transition-colors">Go to Jobs Page</a>
            </div>
        `;
    }

    // --- NEW PROFILE PAGE RENDER FUNCTION ---
    function renderProfilePage(subPage) {
        let mainContent = '';
        let title = '';
        let subtitle = '';

        switch (subPage) {
            case 'security':
                title = 'Security';
                subtitle = 'Manage your password and two-factor authentication.';
                mainContent = `
                    <div class="p-8 bg-[#1A2233] rounded-xl border border-[#222f49] space-y-8">
                        <div>
                            <h2 class="text-white text-xl font-bold mb-4">Password Settings</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="current-password" class="block text-[#90a4cb] text-sm font-medium mb-2">Current Password</label>
                                    <input type="password" id="current-password" class="profile-input">
                                </div>
                                <div>
                                    <label for="new-password" class="block text-[#90a4cb] text-sm font-medium mb-2">New Password</label>
                                    <input type="password" id="new-password" class="profile-input">
                                </div>
                            </div>
                            <div class="flex justify-end mt-6">
                                <button class="px-6 py-3 bg-primary text-white font-bold rounded-xl shadow-lg hover:bg-primary/90 transition-colors" onclick="alert('Password updated!')">
                                    Update Password
                                </button>
                            </div>
                        </div>

                        <div class="pt-6 border-t border-[#222f49]">
                            <h2 class="text-white text-xl font-bold mb-4">Two-Factor Authentication (2FA)</h2>
                            <div class="flex items-center justify-between p-4 bg-[#222f49] rounded-lg">
                                <div>
                                    <p class="text-white font-medium">2FA Status</p>
                                    <p class="text-green-400 text-sm">Enabled</p>
                                </div>
                                <button class="px-4 py-2 bg-red-400/20 text-red-400 hover:bg-red-400/30 transition-colors rounded-lg font-medium" onclick="alert('2FA Disabled!')">
                                    Disable
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                break;
            case 'settings':
                title = 'Settings';
                subtitle = 'Configure application preferences and integrations.';
                mainContent = `
                    <div class="p-8 bg-[#1A2233] rounded-xl border border-[#222f49] space-y-8">
                        <div>
                            <h2 class="text-white text-xl font-bold mb-4">AI Preferences</h2>
                            <div class="flex items-center justify-between p-4 bg-[#222f49] rounded-lg">
                                <div>
                                    <p class="text-white font-medium">Automated Decision Making</p>
                                    <p class="text-[#90a4cb] text-sm">Allow AI to provide a clear recommendation in candidate comparison.</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" value="" class="sr-only peer" checked>
                                    <div class="w-11 h-6 bg-[#314368] peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/50 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                                </label>
                            </div>
                        </div>

                        <div class="pt-6 border-t border-[#222f49]">
                            <h2 class="text-white text-xl font-bold mb-4">Integrations</h2>
                            <div class="flex items-center justify-between p-4 bg-[#222f49] rounded-lg">
                                <div>
                                    <p class="text-white font-medium">Link to ATS (Applicant Tracking System)</p>
                                    <p class="text-[#90a4cb] text-sm">Synchronize candidate data with your main ATS.</p>
                                </div>
                                <button class="px-4 py-2 bg-primary/20 text-primary hover:bg-primary/30 transition-colors rounded-lg font-medium" onclick="alert('ATS Connected!')">
                                    Connect
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                break;
            case 'profile':
            default:
                title = 'Profile';
                subtitle = 'Manage your personal information and preferences.';
                mainContent = `
                    <div class="p-8 bg-[#1A2233] rounded-xl border border-[#222f49]">
                        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-8 pb-4 border-b border-[#222f49]">
                            <div class="flex items-center gap-4">
                                <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full h-20 w-20" style='background-image: url("${USER_PROFILE_DATA.avatar}");'></div>
                                <div class="flex flex-col">
                                    <p class="text-white text-xl font-bold">${USER_PROFILE_DATA.name}</p>
                                    <p class="text-[#90a4cb]">${USER_PROFILE_DATA.email}</p>
                                </div>
                            </div>
                            <button class="mt-4 sm:mt-0 px-4 py-2 bg-[#222f49] text-white/80 hover:bg-primary/30 transition-colors rounded-lg font-medium">
                                Upload new picture
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="full-name" class="block text-[#90a4cb] text-sm font-medium mb-2">Full Name</label>
                                <input type="text" id="full-name" value="${USER_PROFILE_DATA.name}" class="profile-input">
                            </div>
                            <div>
                                <label for="job-title" class="block text-[#90a4cb] text-sm font-medium mb-2">Job Title</label>
                                <input type="text" id="job-title" value="${USER_PROFILE_DATA.title}" class="profile-input">
                            </div>
                            <div>
                                <label for="company" class="block text-[#90a4cb] text-sm font-medium mb-2">Company</label>
                                <input type="text" id="company" value="${USER_PROFILE_DATA.company}" class="profile-input">
                            </div>
                            <div>
                                <label for="email" class="block text-[#90a4cb] text-sm font-medium mb-2">Email Address</label>
                                <input type="email" id="email" value="${USER_PROFILE_DATA.email}" class="profile-input" disabled>
                            </div>
                        </div>

                        <div class="flex justify-end gap-4 mt-8 pt-4 border-t border-[#222f49]">
                            <button class="px-6 py-3 text-[#90a4cb] font-bold rounded-xl hover:text-white transition-colors" onclick="alert('Cancelled changes.')">
                                Cancel
                            </button>
                            <button class="px-6 py-3 bg-primary text-white font-bold rounded-xl shadow-lg hover:bg-primary/90 transition-colors" onclick="alert('Changes saved for ${USER_PROFILE_DATA.name}')">
                                Save Changes
                            </button>
                        </div>
                    </div>
                `;
        }

        return `
            <div class="w-full flex">
                <div class="w-64 mr-10 hidden md:block shrink-0">
                    <div class="p-6 bg-[#1A2233] rounded-xl border border-[#222f49] flex flex-col items-center mb-8">
                        <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full h-16 w-16 mb-3" style='background-image: url("${USER_PROFILE_DATA.avatar}");'></div>
                        <p class="text-white text-lg font-bold">${USER_PROFILE_DATA.name}</p>
                        <p class="text-[#90a4cb] text-sm">${USER_PROFILE_DATA.title}</p>
                    </div>
                    
                    <nav class="space-y-1">
                        <a href="#profile" data-page="profile" class="profile-nav-link flex items-center gap-3 p-3 rounded-lg transition-colors">
                            <span class="material-symbols-outlined">person</span>
                            Profile
                        </a>
                        <a href="#security" data-page="security" class="profile-nav-link flex items-center gap-3 p-3 rounded-lg transition-colors">
                            <span class="material-symbols-outlined">lock</span>
                            Security
                        </a>
                        <a href="#settings" data-page="settings" class="profile-nav-link flex items-center gap-3 p-3 rounded-lg transition-colors">
                            <span class="material-symbols-outlined">settings</span>
                            Settings
                        </a>
                    </nav>
                    
                    <div class="mt-16 pt-4 border-t border-[#222f49]">
                        <button class="flex items-center gap-3 p-3 rounded-lg text-red-400 hover:bg-red-400/20 w-full font-medium transition-colors" onclick="alert('Logging out...')">
                            <span class="material-symbols-outlined">logout</span>
                            Logout
                        </button>
                    </div>
                </div>

                <div class="flex-1 min-w-0">
                    <h1 class="text-white text-4xl font-black leading-tight tracking-[-0.033em]">${title}</h1>
                    <p class="text-[#90a4cb] text-lg font-normal leading-normal mt-2 mb-8">${subtitle}</p>
                    ${mainContent}
                </div>
            </div>
        `;
    }

    // ---------------------------------------------------
    // Routing Logic
    // ---------------------------------------------------

    function handleRouting() {
        const hash = window.location.hash.replace('#', '');
        const page = hash.split('?')[0] || 'dashboard'; // Default to dashboard if no hash is present, ignoring query params
        const mainContent = document.getElementById('app-main-content');
        const askAiButton = document.getElementById('ask-ai-button');
        let pageContent = '';

        if (askAiButton) askAiButton.classList.add('hidden');

        // Render header buttons for the current page
        renderHeaderButtons(page);
        // Set active link in the header and profile sidebar
        setActiveLink(page);
        
        // Clear previous content to allow re-rendering listeners
        mainContent.innerHTML = '';


        switch (page) {
            case 'dashboard':
            case 'home':
                pageContent = renderDashboardPage();
                // We use setTimeout to ensure content is in DOM before attaching listeners
                setTimeout(() => {
                    setupDragAndDropListener('upload-job', 'job-file-input', 'job-file-name', 'job-button-text', 'job');
                    setupUploadListener('upload-job', 'job-file-input', 'job-file-name', 'job-button-text', 'job');
                    setupDragAndDropListener('upload-candidate-a', 'candidate-a-file-input', 'candidate-a-file-name', 'candidate-a-button-text', 'candidateA');
                    setupUploadListener('upload-candidate-a', 'candidate-a-file-input', 'candidate-a-file-name', 'candidate-a-button-text', 'candidateA');
                    setupDragAndDropListener('upload-candidate-b', 'candidate-b-file-input', 'candidate-b-file-name', 'candidate-b-button-text', 'candidateB');
                    setupUploadListener('upload-candidate-b', 'candidate-b-file-input', 'candidate-b-file-name', 'candidate-b-button-text', 'candidateB');
                    document.getElementById('home-compare-button')?.addEventListener('click', () => {
                        window.location.hash = '#compare';
                    });
                    updateCompareButtonState();
                }, 0);
                break;
            case 'compare':
                pageContent = renderComparePage();
                if (jobFileUploaded && candidateAFileUploaded && candidateBFileUploaded && askAiButton) {
                    askAiButton.classList.remove('hidden');
                }
                break;
            case 'candidates':
                pageContent = renderCandidatesPage();
                break;
            case 'jobs':
                // Note: The main 'Jobs' page content is still external (jobs.html)
                pageContent = renderJobsPage();
                break;
            case 'profile':
            case 'security':
            case 'settings':
                // All profile-related pages are handled by the new renderProfilePage function
                pageContent = renderProfilePage(page);
                break;
            default:
                pageContent = renderDashboardPage();
                break;
        }

        // Insert the content into the main container
        mainContent.innerHTML = pageContent;
    }
    
    // Initial routing setup
    window.addEventListener('hashchange', handleRouting);
    window.addEventListener('load', handleRouting);
</script>
</body>
</html>
